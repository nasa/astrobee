<!-- HTML header for doxygen 1.9.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NASA Astrobee Robot Software: Marker Tracking</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.png" type="image/png" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="freeflyer.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 70px;">
  <td id="projectlogo"><img alt="Logo" src="astrobee-logo.png" height="100"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NASA Astrobee Robot Software
   &#160;<span id="projectnumber">0.17.0</span>
   </div>
   <div id="projectbrief">Flight software for the Astrobee robots operating inside the International Space Station.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('markertracking.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Marker Tracking </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This folder provides a library for detecting AR tags using ALVAR.</p>
<h1><a class="anchor" id="autotoc_md320"></a>
Library</h1>
<p>The library, in the src and include directories, provides a class <a class="el" href="classmarker__tracking_1_1MarkerCornerDetector.html">MarkerCornerDetector</a> which takes as input an image and a camera calibration. It then returns the detected marker IDs and the locations of their detected corners in the image.</p>
<h1><a class="anchor" id="autotoc_md321"></a>
ROS Node</h1>
<p>The ROS node takes images and outputs AR tag features.</p>
<h2><a class="anchor" id="autotoc_md322"></a>
Inputs</h2>
<ul>
<li>Camera Images (topic specified on command line, via <code>--image_topic</code>)</li>
<li>AR <a class="el" href="structTag.html">Tag</a> Specification (specified on command line, via <code>--artag_file</code>)</li>
</ul>
<h2><a class="anchor" id="autotoc_md323"></a>
Outputs</h2>
<ul>
<li><code>/localization/ar_tags/features</code></li>
<li><code>/localization/ar_tags/registration</code></li>
</ul>
<h1><a class="anchor" id="autotoc_md324"></a>
Overhead Tracking Node</h1>
<p>This node is for use on spheresgoat in the granite lab. It reads images from the overhead camera, detects an AR tag on the robot, and publishes the ground truth robot pose to <code>/ground_truth</code>.</p>
<p>The node is configured in <code>geometry.config</code> and <code>overhead_tracker.config</code>.</p>
<h1><a class="anchor" id="autotoc_md325"></a>
Marker file usage</h1>
<h2><a class="anchor" id="autotoc_md326"></a>
2D definitions</h2>
<p>AR markers are specified in a config file (Lua). A typical example is <code>dock_markers_print</code>.</p>
<p>The marker file should define at least the following variables:</p><ul>
<li><code>ar_resolution</code> : defines the resolution (address space) of the marker</li>
<li><code>ar_margin</code> : defines the outer black square thickness in cell size unit</li>
<li><code>drawing_width</code>, <code>drawing_height</code> : width and height of the drawing (in drawing unit)</li>
<li><code>markers</code> : table of markers specs with:<ul>
<li><code>id</code> : id of the markers</li>
<li><code>size</code> : size of the outer square defining the markers</li>
<li><code>pos</code> : table of x / y coordinate of the maker (drawing units)</li>
<li><code>white_margin</code> : optional argument specifying a white margin to add around the marker (if not printed on white sheet)</li>
</ul>
</li>
</ul>
<p>The marker positions are defined in the regular SVG coordinate system: X positive to the right, Y positive down.</p>
<p>Since the SVG default drawing origin is the top left corner of the virtual sheet, it is possible to define an offset to place the markers at a specific location on the sheet:</p><ul>
<li><code>drawing_xoffset</code>, <code>drawing_yoffset</code> : x / y offset to apply to all drawing elements.</li>
</ul>
<p>Optional variables are:</p><ul>
<li><code>drawing_unit</code> : default is 'mm'</li>
<li><code>labels</code> : table of labels</li>
<li><code>text_font</code> : define the font to use for labels (drawing wise)</li>
<li><code>holes</code> : table of holes markers</li>
<li><code>black_background</code> : bool to specify that the sheet should be black_background</li>
</ul>
<h2><a class="anchor" id="autotoc_md327"></a>
3D definitions</h2>
<p>The coordinates of the AR markers are defined in a config file (Lua). A typical example is <code>granite_lab_markers.config</code>.</p>
<p>The config file needs to define one variable:</p><ul>
<li><code>markers_world</code> : table of marker specs<ul>
<li><code>id</code> : id of the marker</li>
<li><code>top_left</code> : 3D coordinate of the marker top left corner</li>
<li><code>top_right</code> : 3D coordinate of the marker top left corner</li>
<li><code>bottom_left</code> : 3D coordinate of the marker top left corner</li>
</ul>
</li>
</ul>
<p>Currently <code>granite_lab_markers.config</code> uses the <code>matrix.lua</code> transform to compute the 3D coordinates of the AR markers in the world frame from their 2D definition on the dock.</p>
<h1><a class="anchor" id="autotoc_md328"></a>
Generate dock targets</h1>
<p><code>&lt;ars_src_dir&gt;</code> Top of the Astrobee Robotic Software (ARS) source tree <code>&lt;ars_build_dir&gt;</code> Directory where the software has been compiled, alternatively, it could be the install path of ARS.</p>
<p>Make sure the environment variable <code>ASTROBEE_CONFIG_DIR</code> as been correctly set to <code>&lt;ars_src_dir&gt;/astrobee/config</code> (or install path). </p><div class="fragment"><div class="line">&lt;ars_build_dir&gt;/bin/generate_svg_markers dock_markers_print.config target2print.svg</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md329"></a>
Others</h1>
<h2><a class="anchor" id="autotoc_md330"></a>
Important config files</h2>
<ul>
<li><code>dock_markers_specs.config</code> : specification of the markers in 2D</li>
<li><code>dock_markers_print.config</code> : includes dock_markers_specs, and adds printing features (offset on paper, labels, etc.)</li>
<li><code>granite_lab_markers.config</code> : includes dock_makers_specs, and generate coordinates of the markers in 3D from the dock position and orientation. The variable <code>markers_world</code> contains the same list of markers than <code>markers</code>, but with the computed 3D coordinates.</li>
</ul>
<h2><a class="anchor" id="autotoc_md331"></a>
Old XML format and new "config" format</h2>
<p>The AR markers were originally described with an XML file. These files can still be processed with the <code>marker_tracking/src/arxmlio.cc</code> parser using <code>LoadARTagLocation</code>.</p>
<p>The new system standardize on the Lua config file, and at the same time offers much more flexibilty since positions can be programatically computed. The new parser is in <code>marker_tracking/src/arconfigio.cc</code> and use the function <code>LoadARTagsConfig</code>.</p>
<p>A converter (also acting as a simple test program) is available: <code>marker_config2xml</code>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.0-->
<!-- start footer part -->
<script type="text/javascript" src="/astrobee/doc_version_select.js"></script>
</body>
</html>
