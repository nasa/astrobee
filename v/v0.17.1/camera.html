<!-- HTML header for doxygen 1.9.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NASA Astrobee Robot Software: Camera library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.png" type="image/png" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="freeflyer.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 70px;">
  <td id="projectlogo"><img alt="Logo" src="astrobee-logo.png" height="100"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NASA Astrobee Robot Software
   &#160;<span id="projectnumber">0.17.1</span>
   </div>
   <div id="projectbrief">Flight software for the Astrobee robots operating inside the International Space Station.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('camera.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Camera library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This library handles camera calibration parameters and transformations, providing functions to handle between undistorted and distorted coordinate frames, and other helper functions to deal with reading and applying camera transformations.</p>
<p>A tool named <code>undistort_image</code> is provided that can undistort (and optionally crop) a given set of images.</p>
<p>The undistorted image dimensions, as well as the focal length and undistorted optical center will be displayed on the screen.</p>
<p>Usage: </p><pre class="fragment">export ASTROBEE_RESOURCE_DIR=$SOURCE_PATH/astrobee/resources
export ASTROBEE_CONFIG_DIR=$SOURCE_PATH/astrobee/config
export ASTROBEE_WORLD=granite
export ASTROBEE_ROBOT=p4d

undistort_image input_dir/*[0-9].jpg --output_directory output_dir \
  --robot_camera nav_cam
</pre><p>Options:</p>
<p>&ndash;image_list: A file having the list of images to undistort, one per line. If not specified it is assumed they are passed in directly on the command line.</p>
<p>&ndash;output_directory: Output directory. If not specified, undistorted images will saved in the same directory as the inputs.</p>
<p>&ndash;scale: Undistort images at different resolution, with their width being a multiple of this scale compared to the camera model. The default is 1.</p>
<p>&ndash;undistorted_crop_win: After undistorting, apply a crop window of these dimensions centered at the undistorted image center. The adjusted dimensions and optical center will be printed on screen. Specify as: 'crop_x crop_y'. Or specify 'loose' to use the smallest crop window that contains all of the undistorted source pixels and keeps the optical center centered.</p>
<p>&ndash;save_bgr: Save the undistorted images as BGR instead of grayscale. (Some tools expect BGR.)</p>
<p>&ndash;histogram_equalization: If true, do histogram equalization.</p>
<p>&ndash;robot_camera: Which of bot's cameras to use. Tested with nav_cam and sci_cam. The default is nav_cam.</p>
<p>&ndash;alpha: Add an alpha channel and make areas outside the remapped input transparent. Forces PNG output format. Not compatible with save_bgr.</p>
<p>&ndash;cubic: Use more expensive cubic interpolation for best image quality.</p>
<h2><a class="anchor" id="autotoc_md249"></a>
Notes</h2>
<p>For stitching Astrobee SciCam panoramas, the Hugin tools by default expect input image frames to have a "rectilinear" camera model. We can satisfy this by preprocessing input frames using <code>undistort_image</code>. This lets us lean on our own quality-controlled SciCam calibration rather than adding extra lens parameters to complicate Hugin's already huge and not-always-stable stitching optimization problem.</p>
<p>The following flags are recommended for this use case:</p>
<p>&ndash;undistorted_crop_win loose: The undistorted image is not in general rectangular. This argument tells the tool to use the tightest crop box that saves all the useful remapped pixels and keeps the optical center centered. The resulting images are much smaller than when uncropped and help to avoid Hugin errors that can come from poorly conditioned math with an overly-wide field of view.</p>
<p>&ndash;alpha: Since the undistorted image is not rectangular, there will be some junk where there is no real data around the borders. By default, it is black, but this argument adds an alpha channel so it can be transparent. Luckily, Hugin will respect an alpha channel in the input images if it is provided, so we won't see random black border bits in the stitched output.</p>
<p>&ndash;cubic: We want to avoid losing image quality wherever possible, since that is what the panorama users care about! Mild quality improvement, takes a bit longer. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.0-->
<!-- start footer part -->
<script type="text/javascript" src="/astrobee/doc_version_select.js"></script>
</body>
</html>
