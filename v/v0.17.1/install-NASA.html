<!-- HTML header for doxygen 1.9.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NASA Astrobee Robot Software: Install for NASA users</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.png" type="image/png" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="freeflyer.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 70px;">
  <td id="projectlogo"><img alt="Logo" src="astrobee-logo.png" height="100"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NASA Astrobee Robot Software
   &#160;<span id="projectnumber">0.17.1</span>
   </div>
   <div id="projectbrief">Flight software for the Astrobee robots operating inside the International Space Station.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('install-NASA.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Install for NASA users </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md146"></a>
Usage instructions for NASA users</h1>
<p>Make sure your system is up-to-date and: </p><pre class="fragment">sudo apt-get install build-essential git
</pre><h2><a class="anchor" id="autotoc_md147"></a>
Machine setup</h2>
<h3><a class="anchor" id="autotoc_md148"></a>
Username</h3>
<p>If you are using a VM with a username that does not match your NDC username, please configure the following variable: </p><pre class="fragment">export NDC_USERNAME=your_ndc_username
</pre><h3><a class="anchor" id="autotoc_md149"></a>
Access to the Astrobee Debian server</h3>
<p>The custom debian packages are currently distributed by the <code>astrobee.ndc.nasa.gov server</code>. This server is currently on the ARC TI private network. It is <em>critical</em> to be able to reach this server to install the pre-built custom debian. If none of the solutions below allow you to reach <code>astrobee.ndc.nasa.gov</code>, you can use the instructions on how to build the Debian dependencies manually following the INSTALL.md instructions (Dependencies section).</p>
<h4><a class="anchor" id="autotoc_md150"></a>
If on the ARC TI private network</h4>
<p>This is the typical case for all wired computers in ARC TI, and simplifies your life greatly.</p>
<p>Verify that you are in this situation with the command below should succeed (certificate will be added later; remove the Release.gpg file after being fetched). </p><pre class="fragment">wget -v --no-check-certificate http://astrobee.ndc.nasa.gov/software/dists/xenial/Release.gpg
</pre><p>Before running the scripts in <code>scripts/setup</code> below, set this variable: </p><pre class="fragment">export NO_TUNNEL=1
</pre><h4><a class="anchor" id="autotoc_md151"></a>
If not on the ARC TI private network</h4>
<p>If you are outside the NASA ARC private network, to reach <code>astrobee.ndc.nasa.gov</code>:</p>
<ol type="1">
<li>Use VPN to act like if you were inside the ARC TI private network and obtain the correct kerberos credentials inside the VM with the following command (note the capitalization): <code>kinit $NDC_USERNAME@NDC.NASA.GOV</code></li>
<li>setup your <code>.ssh/config</code> to do ssh forwarding. A tutorial on this method is available at: <a href="https://babelfish.arc.nasa.gov/trac/freeflyer/wiki/SSHSetup">https://babelfish.arc.nasa.gov/trac/freeflyer/wiki/SSHSetup</a></li>
</ol>
<p>For either solution, please verify that you can SSH to <code>m.ndc.nasa.gov</code> without entering your password (<code>m</code> can be used to tunnel to <code>astrobee.ndc.nasa.gov</code>):</p>
<p><code>ssh $NDC_USERNAME@m.ndc.nasa.gov</code></p>
<p>The command should succeed without entering your password. Once this is verified, exit this session on <code>m</code> with <code>&lt;ctrl&gt;+D</code>.</p>
<ul>
<li>These notes apply to <code>install_desktop_16.04_packages.sh</code> and <code>make_chroot.sh</code></li>
</ul>
<h3><a class="anchor" id="autotoc_md152"></a>
Checkout the project source code</h3>
<p>At this point you need to decide where you'd like to put the source code (<code>ASTROBEE_WS</code>) on your machine: </p><pre class="fragment">export ASTROBEE_WS=$HOME/astrobee
</pre><p>First, clone the flight software repository: </p><pre class="fragment">git clone https://github.com/nasa/astrobee.git --branch develop $ASTROBEE_WS/src
pushd $ASTROBEE_WS/src
git submodule update --init --depth 1 description/media
git submodule update --init --depth 1 submodules/platform
</pre><p>You can either choose which optional submodules to clone and log depth with: </p><pre class="fragment">git submodule update --init --depth 1 submodules/android
git submodule update --init --depth 1 submodules/avionics
</pre><p>Or checkout all the submodules as: </p><pre class="fragment">git submodule update --init --depth 1
</pre><p>(Note: re-enter your username and password for every submodule that is cloned) The android module is necessary for guest science code; the avionics and platform module is used when cross-compiling to test on the robot hardware.</p>
<h3><a class="anchor" id="autotoc_md153"></a>
Dependencies</h3>
<p>Next, install all required dependencies:</p>
<p><em>Note: <code>root</code> access is necessary to install the compiled debian packages below</em></p>
<p><em>Note: Before running this please ensure that your system is completely updated by running 'sudo apt-get update' and then 'sudo apt-get upgrade'</em> </p><pre class="fragment">pushd $ASTROBEE_WS
cd src/scripts/setup
./add_local_repository.sh
./add_ros_repository.sh
./install_desktop_packages.sh
popd
</pre><h2><a class="anchor" id="autotoc_md154"></a>
Configuring the build</h2>
<h3><a class="anchor" id="autotoc_md155"></a>
Note for build setup</h3>
<p>When compiling, the <code>$WORKSPACE_PATH</code> defines where the <code>devel</code>, <code>build</code>, <code>logs</code> and <code>install</code> directories are created. If you want to customize the <code>install</code> path then the <code>$INSTALL_PATH</code> can be defined. By default, the configure script uses the following paths:</p>
<ul>
<li>native build path (WORKSPACE_PATH): <code>$ASTROBEE_WS</code></li>
<li>native install path (INSTALL_PATH): <code>$ASTROBEE_WS/install</code></li>
<li>armhf build path (WORKSPACE_PATH): <code>$ASTROBEE_WS/armhf</code></li>
<li>armhf install path (INSTALL_PATH): <code>$ASTROBEE_WS/armhf/opt/astrobee</code></li>
</ul>
<p>You should set these values in your shell.</p>
<p>If you are satisfied with these paths, you can invoke the <code>configure.sh</code> without the <code>-p</code> and <code>-w</code> options. For the simplicity of the instructions below, we assume that <code>$WORKSPACE_PATH</code> and <code>$INSTALL_PATH</code> contain the location of the build and install path for either <code>native</code> or <code>armhf</code> platforms.</p>
<h2><a class="anchor" id="autotoc_md156"></a>
Native vs Cross-Compile</h2>
<p>At this point you need to decide whether you'd like to compile natively [<code>native</code>] (run code against a simulator) or cross-compile for an ARM target [<code>armhf</code>] (run the code on the robot itself). Please skip to the relevant subsection.</p>
<h2><a class="anchor" id="autotoc_md157"></a>
Native - Running the code on your computer with simulator</h2>
<h2><a class="anchor" id="autotoc_md158"></a>
Native build</h2>
<p>The configure script prepares your build directory for compiling the code. Note that <code>configure.sh</code> is simply a wrapper around CMake that provides an easy way of turning on and off options. To see which options are supported, simply run <code>configure.sh -h</code>. </p><pre class="fragment">pushd $ASTROBEE_WS
./src/scripts/configure.sh -l
source ~/.bashrc
popd
</pre><p>The configure script modifies your <code>.bashrc</code> to source <code>setup.bash</code> for the current ROS distribution and to set CMAKE_PREFIX_PATH. It is suggested to examine it and see if all changes were made correctly.</p>
<p>If you want to explicitly specify the workspace and/or install directories, use instead: </p><pre class="fragment">./scripts/configure.sh -l -p $INSTALL_PATH -w $WORKSPACE_PATH
</pre><p><em>Note: If a workspace is specified but not an explicit install distectory, install location will be $WORKSPACE_PATH/install.</em></p>
<h3><a class="anchor" id="autotoc_md159"></a>
Building the code</h3>
<p>To build, run <code>catkin build</code> in the <code>$WORKSPACE_PATH</code>. Note that depending on your host machine, this might take in the order of tens of minutes to complete the first time round. Future builds will be faster, as only changes to the code are rebuilt, and not the entire code base. </p><pre class="fragment">pushd $ASTROBEE_WS
catkin build
popd
</pre><p>Note: In low-memory systems, it is common to run out of memory while trying to compile ARS, which triggers a compilation error mentioning "arm-linux-gnueabihf-g++: internal 
compiler error: Killed (program cc1plus)". A contributing factor is that catkin build by default runs multiple jobs in parallel based on the number of cores available in your environment, and all of these jobs draw on the same memory resources. If you run into this compile error, try compiling again with the -j1 option to restrict catkin to running one job at a time.</p>
<p>For more information on running the simulator and moving the robot, please see the <a class="el" href="running-the-sim.html">Running the Astrobee Simulator</a>.</p>
<h2><a class="anchor" id="autotoc_md160"></a>
Cross-compile - Running the code on a real robot</h2>
<p>In order to do this, you will need to followe the cross-compile build instructions.</p>
<h3><a class="anchor" id="autotoc_md161"></a>
Cross-compile setup</h3>
<p>If you are planning to compile code to run on the robot hardware, you will need to install a cross-compile chroot and toolchain. Select two directories for these: </p><pre class="fragment">export ARMHF_CHROOT_DIR=$HOME/arm_cross/rootfs
export ARMHF_TOOLCHAIN=$HOME/arm_cross/toolchain/gcc
</pre><p>Append these lines to your .bashrc file, as you will need these two variables every time you cross compile.</p>
<p>Next, download the cross toolchain and install the chroot: </p><pre class="fragment">mkdir -p $ARMHF_TOOLCHAIN
cd $HOME/arm_cross
$ASTROBEE_WS/src/submodules/platform/fetch_toolchain.sh
$ASTROBEE_WS/src/submodules/platform/rootfs/make_chroot.sh xenial dev $ARMHF_CHROOT_DIR
</pre><p><em>Note: The last script shown above needs the packages <code>qemu-user-static</code> (not <code>qemu-arm-static</code>) and <code>multistrap</code> to be installed (can be installed through apt).</em></p>
<h3><a class="anchor" id="autotoc_md162"></a>
Cross-compile build</h3>
<p>Cross compiling for the robot follows the same process, except the configure script takes a <code>-a</code> flag instead of <code>-l</code>. </p><pre class="fragment">pushd $ASTROBEE_WS
./src/scripts/configure.sh -a
popd
</pre><p>Or with explicit build and install paths: </p><pre class="fragment">./scripts/configure.sh -a -p $INSTALL_PATH -w $WORKSPACE_PATH
</pre><p><em>Warning: <code>$INSTALL_PATH</code> and <code>$WORKSPACE_PATH</code> used for cross compiling HAVE to be different than the paths for native build! See above for the default values for these.</em></p>
<p>Once the code has been built, it also installs the code to a singular location. CMake remembers what <code>$INSTALL_PATH</code> you specified, and will copy all products into this directory.</p>
<h3><a class="anchor" id="autotoc_md163"></a>
Install the code on the robot</h3>
<p>Once the installation has completed, copy the install directory to the robot. This script assumes that you are connected to the Astrobee network, as it uses rsync to copy the install directory to <code>~/armhf</code> on the two processors. It takes the robot name as an argument. Here we use <code>p4d</code>. </p><pre class="fragment">pushd $ASTROBEE_WS
./src/scripts/install_to_astrobee.sh $INSTALL_PATH p4d
popd
</pre><p>Here, p4d is the name of the robot, which may be different in your case.</p>
<p>You are now ready to run the code. This code launches a visualization tool, which starts the flight software as a background process. </p><pre class="fragment">pushd $ASTROBEE_WS
python ./src/tools/gnc_visualizer/scripts/visualizer --proto4
popd
</pre><h2><a class="anchor" id="autotoc_md164"></a>
Switching build profiles</h2>
<p>To alternate between native and armhf profiles: </p><pre class="fragment">catkin profile set native
catkin profile set armhf
</pre><h1><a class="anchor" id="autotoc_md165"></a>
Further information</h1>
<p>Please refer to the <a href="https://github.com/nasa/astrobee/wiki">wiki</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.0-->
<!-- start footer part -->
<script type="text/javascript" src="/astrobee/doc_version_select.js"></script>
</body>
</html>
