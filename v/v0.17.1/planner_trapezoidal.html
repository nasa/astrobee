<!-- HTML header for doxygen 1.9.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NASA Astrobee Robot Software: Trapezoidal planner</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.png" type="image/png" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="freeflyer.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 70px;">
  <td id="projectlogo"><img alt="Logo" src="astrobee-logo.png" height="100"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NASA Astrobee Robot Software
   &#160;<span id="projectnumber">0.17.1</span>
   </div>
   <div id="projectbrief">Flight software for the Astrobee robots operating inside the International Space Station.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('planner_trapezoidal.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Trapezoidal planner </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The trapezoidal planner provides a baseline mechanism for generating <b>segments</b> that pass through a supplied sequence of poses. It constructs linear translations between poses, with a trapezoidal ramp on angular and linear velocity. This planner is completely agnostic to clutter and keep-out zones, and so it is typically used for short moves, like those in docking or perching.</p>
<p>Astrobee is a <b>holonomic</b> vehicle, and is therefore capable of both rotating ans translating simultaneously when moving from one pose to another. However, there are several compelling reasons why one would want to opt-out of this behaviour in favor of a <b>face-forward</b> mode. In this mode Astrobee is oriented to face along the direction of translation.</p>
<ol type="1">
<li>Face-forward mode always ensures that during translations the hazard detection camera always points in the direction of motion. This increases the likelihood of the robot "seeing" any obstacle in the desired path.</li>
<li>The robot's acceleration is fundamentally constrained by a hard limit on how much pressure the impellers can build in the plenum. During holomnic moves this energy mst be spread along six degrees of freedom. This lowers the angular and linear acceleration limits.</li>
<li>It is easier for an astronaut or operator to determine the intent of the freeflyer when it nominally moves in the direction it faces.</li>
</ol>
<h1><a class="anchor" id="autotoc_md456"></a>
Basic operation</h1>
<p>Describing how the trapezoidal planner works requires the definition of several input parameters:</p>
<ul>
<li>Hard limits - These are the maximum linear and angular velocity and acceleration magnitudes that the propulsion system can safely achieve, and is dictated by the current flight mode. It is calculated a priori and depends on the impeller speeds, controller gains and inertial properties of the platform.</li>
<li>Soft limits - These are customizable limits on the linear and angular velocities and acceleration magnitudes. It allows the use to specify target values that are lower than the hard upper limits.</li>
<li>Time limits - As part of the request the callee provides timestamps with each desired pose, which implictly encodes a "time limit" to get from one target pose to the next. The trapezoidal planner will try and choose a linear and angular velocity in order to satisfy this time limit. If this is not possible (the soft or hard limits are violated) then the soft limits are used, which lengthens the duration of segment.</li>
</ul>
<p>The limit precedence is therefore the following:</p>
<p>hard limits &gt; soft limits &gt; time limits</p>
<p>The planner take in as an argument a time-indexed sequence of poses to move through. Using the limit hierarchiy above it outputs a fully-defined segment containing a sequence of setpoints, each specifying a postion, orientation, velocity, angular velocity, acceleration and angular acceleration.</p>
<h2><a class="anchor" id="autotoc_md457"></a>
Holonomic moves</h2>
<p>We'll begin by considering a holonomic move, which is an a sense the generalization of a face-forward move. A face-forward move follows the same core construction logic except that it structures the move as a rotation-translation-rotation sequence, and in so doing yields a segment in which rotation and translation is never performed simultaneously.</p>
<p>The first challenge with a holomic move is to determine whether of the linear or angular components <code>dominates</code>. That is, we need to know whether it will take longer to rotate or translate based on our set of hard/soft/time limits. Once the dominating axis and duration is known, we select a lower limit for the other axis so that its motion is "spread" to take the same time as the dominating axis. Not doing this leads to counter-intuitive moves, like rotation completing several seconds before the translation does.</p>
<p>Once the dominating duration is known, the problem reduces to finding separate velocity profiles for the linear and angular components of the move. The sequence of setpoints is produced by sampling the profiles. For the less intuitive case of orientation, integrating the angular velocity profile yields the angle (magnitude) component of an angle-axis orientation representation, which we can then convert to a quaternion for use in a setpoint.</p>
<p>The one subtle detail that one must be careful to account for is the fact that the velocity profile may in fact be a pyramid and not a trapezoid. This happens when the angle or distance moved is short and the acceleration limit is low. In this case the axis never ramps up to its velocity limit before needing to ramp down to stop at the correct point. Equivalently, it never reaches cruising speed and therefore it's cruise duration is zero.</p>
<h2><a class="anchor" id="autotoc_md458"></a>
Face-forward moves</h2>
<p>The same planning algorithm is used for face-forward mode, except the motion is split into three distinct phases - (1) look, (2) translate, (3) rotate.</p>
<p>(1) In the look-phase the freeflyer performs a rotation to align its forward direction (body-frame X) with the vector pointing in the direction it intends to translates. There is one remaining degree of freedom that remains unconstrained (roll, or rotation about body-frame x). We select this value in such a way that the body-frame y axis lies in the world X-Y plane. This nominally keeps the freeflyer oriented so that its body-frame Z never inverts with respect the world Z. This works for all motions except pure downward translations. In this case we align body-frame Y with the Y-Z plane.</p>
<p>(2) In the translate phase the robot moves from its initial to final position without any orientation change. Since the final orientation of the look phase pointed in the direction of translation the robot always "looks forward".</p>
<p>(2) In the rotate phase of a face-forward move the robot reorients itself to be pointed in the direction of the end pose.</p>
<h1><a class="anchor" id="autotoc_md459"></a>
Usage</h1>
<p>Although one could theoretically interact with the trapezoidal planner, this is not advised. To generate and execute a trapezoidal plan one should use the move command in conjunction with the "trapezoidal" planner flag. Here is an example command that shows how to move to the origin of the world: </p><pre class="fragment">rosrun mobility teleop -move -pos "0 0 0" -att "0" -planner trapezoidal
</pre><p>By default the teleop tool configures the platform to operate in holomonic mode. To enforce face-forward mode the "-ff" flag can be used. For example: </p><pre class="fragment">rosrun mobility teleop -move -pos "0 0 0" -att "0" -planner trapezoidal -ff
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.0-->
<!-- start footer part -->
<script type="text/javascript" src="/astrobee/doc_version_select.js"></script>
</body>
</html>
