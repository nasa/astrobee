<!-- HTML header for doxygen 1.9.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NASA Astrobee Robot Software: Debians management for deployment on the physical robots</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.png" type="image/png" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="freeflyer.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 70px;">
  <td id="projectlogo"><img alt="Logo" src="astrobee-logo.png" height="100"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NASA Astrobee Robot Software
   &#160;<span id="projectnumber">0.17.0</span>
   </div>
   <div id="projectbrief">Flight software for the Astrobee robots operating inside the International Space Station.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('managing_debians.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Debians management for deployment on the physical robots </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page describes the steps to deploy FSW Debian packages on the server.</p>
<p>The Debian are deploy in 3 phases:</p><ol type="1">
<li>Build the Debian package (freeflyer or freeflyer_avionics)</li>
<li>Stage the package on volar</li>
<li>Create a new Debian snapshot on the astrobee server</li>
</ol>
<p>Steps 2 and 3 are similar for any Debian update Step 1 is slightly different for freeflyer or freeflyer_avionics.</p>
<p>Setup: </p><pre class="fragment">export FF_AVIONICS=&lt;path_to_your_avionics_repository&gt;
</pre><p>More information on how Astrobee is using <a href="https://www.aptly.info/doc/overview/">aptly</a> is described in: ../scripts/setup/Debians/mirror/README.md "Debians mirror documentation"</p>
<h2><a class="anchor" id="autotoc_md132"></a>
Build Freeflyer Debian</h2>
<p>Your environment needs to be configured properly to cross-compile Astrobee Robot Software for the <code>armhf</code> architecture: <a class="el" href="NASA__INSTALL_8md.html">see NASA Install documentation</a></p>
<h3><a class="anchor" id="autotoc_md133"></a>
Creating a release</h3>
<p>Please see the <a class="el" href="flight__release_8md.html">flight release documentation</a> for informationon how to create a release and update the release version.</p>
<h3><a class="anchor" id="autotoc_md134"></a>
Create the Debian package</h3>
<pre class="fragment">./scripts/build/build_debian.sh
</pre><h2><a class="anchor" id="autotoc_md135"></a>
Build Avionics Debian</h2>
<p>The <code>avionics</code> Debian is build separatly from the <code>freeflyer</code> Debian because it does not rely on the same toolchain, follow a different release schedule and is not yet open source.</p>
<h3><a class="anchor" id="autotoc_md136"></a>
Update changelog</h3>
<pre class="fragment">cd $FF_AVIONICS
dch -v &lt;version.number&gt; -c debian/changelog
</pre><h3><a class="anchor" id="autotoc_md137"></a>
Push the new changelog</h3>
<pre class="fragment">git commit -m"meaningful message" debian/changelog
git push
</pre><h3><a class="anchor" id="autotoc_md138"></a>
Create the Debian package</h3>
<pre class="fragment">./tools/build_debian.sh
# answer y/n when the prompt ask about Harmony install
</pre><h2><a class="anchor" id="autotoc_md139"></a>
Common steps: staging and snapshoting</h2>
<h3><a class="anchor" id="autotoc_md140"></a>
Stage the Debian on volar</h3>
<pre class="fragment">cd ..
export ASTROBEE_DEBIAN_DIR=/home/p-free-flyer/free-flyer/FSW/ars_debs/dists/xenial/main
scp astrobee-avionics_&lt;version&gt;_*.deb \
  &lt;ndc_username&gt;@volar:$ASTROBEE_DEBIAN_DIR/binary-armhf
</pre><h3><a class="anchor" id="autotoc_md141"></a>
Update the Debian mirror on volar</h3>
<pre class="fragment">ssh volar
cd /home/p-free-flyer/free-flyer/FSW/aptly/scripts
./update_astrobee_debians.sh
</pre><p>Warnings [!] will be displayed for the existing packages, but the new generated debian should be listed with a [+].</p>
<h3><a class="anchor" id="autotoc_md142"></a>
Sign the Debian</h3>
<p>This step is only required if you do not already have imported the key to sign the Debians. This step requires to have access to the private key maintained by Brian Coltin.</p>
<p>Master key owner: </p><pre class="fragment">gpg --export-secret-key
</pre><p>New user: </p><pre class="fragment">gpg --import ~bcoltin/secret.key
</pre><p>Master key owner deletes <code>secret.key</code></p>
<h3><a class="anchor" id="autotoc_md143"></a>
Push Debian to the server</h3>
<pre class="fragment">./publish_snapshot.sh &lt;snapshot_date_and_tag&gt;
</pre><p>Convention for the argument: follow this example 20180702_pre-dock-flight-release. Input the Master Password when asked (twice).</p>
<h2><a class="anchor" id="autotoc_md144"></a>
Build FSW dependencies Debians packages</h2>
<p>When a FSW dependecy is changed, it is necessary to rebuild the Debian packages: </p><pre class="fragment">./scripts/setup/debians/build_install_debians.sh
</pre><p>Then, follow the common step above to stage the Debian packages on volar and create the snapshot on the server. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.0-->
<!-- start footer part -->
<script type="text/javascript" src="/astrobee/doc_version_select.js"></script>
</body>
</html>
