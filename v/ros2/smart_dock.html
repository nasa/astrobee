<!-- HTML header for doxygen 1.9.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NASA Astrobee Robot Software: Smart dock driver</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.png" type="image/png" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="freeflyer.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 70px;">
  <td id="projectlogo"><img alt="Logo" src="astrobee-logo.png" height="100"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NASA Astrobee Robot Software
   &#160;<span id="projectnumber">0.17.0</span>
   </div>
   <div id="projectbrief">Flight software for the Astrobee robots operating inside the International Space Station.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('smart_dock.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Smart dock driver </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <a class="el" href="namespacesmart__dock.html">smart_dock</a> package provides a single non-ROS service that accepts a DDS command to wake up an Astrobee that is docked to berth 1 or 2. It is essentially a proxy that converts this command to a <a class="el" href="namespacei2c.html">i2c</a> transaction that is sent from the amrt dock running Linux to the slave dock controller. The dock controller then sets an internal register, which is then collected at some future point in time by the astrobee, which is an <a class="el" href="namespacei2c.html">i2c</a> master on a separate bus. </p><pre class="fragment">[smart dock] &lt;(m)-i2c-(s)&gt; [dock controller] &lt;-(s)-i2c-(m)-&gt; [astrobee]
</pre><h1><a class="anchor" id="autotoc_md231"></a>
Implementation details</h1>
<p>Like most of the hardware drivers, there is a proxy library (<a class="el" href="namespacesmart__dock.html">smart_dock</a>) that provides an abstraction away from the <a class="el" href="namespacei2c.html">i2c</a> bus transactions. The smart_dock_node is a free-standing DDS application that provides a bridge between the network and the proxy library. The smart_dock_tool is a simple command-line utility that allows one to manually probe the smart dock.</p>
<h1><a class="anchor" id="autotoc_md232"></a>
Functional test</h1>
<p>Ultimately, smart dock will bem automatically launched as a systemd service. Take a look in the scripts/daemon/dock folder of the astrobee robot software for example service files for doing this. If you have not installed the service then you can run it manually:</p>
<p>First, make sure nothing is docked to either of the berths. Then, make sure you are connected to the ISS network. You can not SSH into the dock using its ISS IP and run the smart_dock_service application: </p><pre class="fragment">ssh astrobee@$DOCK_IP
[dock] astrobee@dock:/res$ smart_dock_service
</pre><p>This application pushes telemetry whenever the dock state changes. It also respondes to commands from GDS and wakes up a robot that is berthed in hibernate mode.</p>
<p>You can now launch GDS, making sure the DOCK_IP is in your DDS peer list. If all works correctly, you should see "Vacant" in both berths listen under the "Docking Station Status and Commanding" pane, which is the bottom left quarter of the opening screen.</p>
<p>Now, turn on the power switch to an astrobee but do not wake it up with the wake button. In stead, plug the astrobee into berth 1. In less than 10 seconds you should see berth 1 update to reflect the name of the astrobee and the fact that it's in hibernate mode. You might also notice that you can now wake the astrobee using the button underneath the status panes.</p>
<p>Finally, press the "wake" button in the "Wake Commanding" pane. You should see the status change to "Awake" and, if your computer, the dock and the freeflyer are all connected to the ISS network, then after 30 seconds or so you should see the astrobee you woke up in the "Bee Status" pane.</p>
<p>If any of the above fails, check that your network configuration is correct and try using the command-line tool to verify the dock functionality.</p>
<h1><a class="anchor" id="autotoc_md233"></a>
Command-line tool</h1>
<p>The tool cannot be run if the the service is already running. Before running any of the commands below, make please use systemctl to make sure that the service is not running.</p>
<p>You can retrieve help on using the tool in the following way: </p><pre class="fragment">smart_dock_tool -help
</pre><p>Here's what you should see when the EPS is connected to the bus: </p><pre class="fragment">DESCRIPTION
 Command-line tool for interacting with the smart dock

SUBSYSTEM CONTROL
 The tool supports the following subsystem flags
  -power    : Turn on an off power to dock channels
  -led      : Configure dock LEDs to be on, off or flash
  -berth    : View information about a given berth
  -command  : Send a command to a given berth
  -hk       : View dock housekeeping information
  -fault    : View and clear dock fault information
  -string   : View dock build info, software and serial
 For more help about a specific subsystem, add the flag
  eg. smart_dock_tool -power

ONE-SHOT COMMANDS
 The tool supports the following oneshot commands
  -reboot       : Reboot the smart dock
 To use the command, just add the flag
  eg. smart_dock_tool -reboot
</pre><p>The dock controller is largely based off the EPS code, and so the -power, -led, -hk, -fault and -string switches are similar. The -berth and -command switches are unique to the dock, and enable the user to respectively get information about the robot attached to each of the two berths, as well as send one of several commands to that robot.</p>
<p>For example, to print information about the berths, type the following: </p><pre class="fragment">smart_dock_tool -berth -get
</pre><p>To get a list of all commands that you can send to a robot, type the following: </p><pre class="fragment">smart_dock_tool -command -list
</pre><p>To send a nominal wake up command to the robot on berth 1, type the following; </p><pre class="fragment">smart_dock_tool -command -set wake 1
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.0-->
<!-- start footer part -->
<script type="text/javascript" src="/astrobee/doc_version_select.js"></script>
</body>
</html>
